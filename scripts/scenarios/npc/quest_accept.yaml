# Quest acceptance scenario - tests accepting a quest from an NPC
# Uses demo mode with pre-generated test world (Peaceful Village has Elder Theron with "Scout the Ruins" quest)
scenario:
  name: "Quest Accept from NPC"
  description: "Test talking to NPC and accepting a quest in demo mode"
  seed: 42013  # Unique seed for this scenario
  config:
    max_commands: 30
    timeout: 90
    demo_mode: true  # Use pre-generated test world

  setup:
    - "dump_state"  # Get initial state

  steps:
    # Step 1: Verify starting location (Peaceful Village at [0,0])
    - command: "look"
      assertions:
        - type: NARRATIVE_MATCH
          field: ""
          value: "Peaceful Village"
          message: "Should start at Peaceful Village in demo mode"

    # Step 2: Check initial state - verify NPCs are present
    - command: "dump_state"
      assertions:
        - type: CONTENT_PRESENT
          field: "npcs"
          value: true
          message: "NPCs should be present at Peaceful Village"

    # Step 3: Talk to Elder Theron (quest giver with "Scout the Ruins")
    - command: "talk Elder Theron"
      assertions:
        - type: COMMAND_VALID
          field: ""
          value: true
          message: "Talk to Elder Theron should be valid"
        - type: NARRATIVE_MATCH
          field: ""
          value: "Theron"
          message: "Should see Elder Theron's dialogue"

    # Step 4: Accept the quest
    - command: "accept Scout the Ruins"
      assertions:
        - type: COMMAND_VALID
          field: ""
          value: true
          message: "Accept quest command should be valid"
        - type: NARRATIVE_MATCH
          field: ""
          value: "Scout the Ruins"
          message: "Quest acceptance should reference the quest name"

    # Step 5: Verify quest was added to character
    - command: "dump_state"
      assertions:
        - type: STATE_CONTAINS
          field: "quests"
          value: "Scout the Ruins"
          message: "Quest should appear in active quests"

    # Step 6: Check quests command shows the new quest
    - command: "quests"
      assertions:
        - type: COMMAND_VALID
          field: ""
          value: true
          message: "Quests command should work"
        - type: NARRATIVE_MATCH
          field: ""
          value: "Scout the Ruins"
          message: "Quest list should show accepted quest"
